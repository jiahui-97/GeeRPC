# geerpc

## 简介
一个简易 RPC 框架

RPC(Remote Procedure Call，远程过程调用)是一种计算机通信协议，允许调用不同进程空间的程序。

一般和 RPC 进行对比的是基于 HTTP 协议的 Restful 框架。HTTP 协议一般来讲有更好可读性，相对 RPC 来讲，有一些缺点
1. HTTP 报文冗余，有很多无用信息，RPC 可以自定义格式，
2. RPC 可以采用高效的序列化协议，用二进制传输，获取更高的性能，
3. RPC 更灵活，可以在其上实现一些注册中心、负载均衡等功能

假设客户端与服务端进行通信，客户端不关心服务端机器的部署信息，只关注自己的请求是否得到需要的结果。因此，在 RPC 框架中，需要实现注册中心和负载均衡，在业务侧提供一些公用能力，如消息编解码、连接池、收发线程、超时处理等

## 进度

- [x] 服务端与消息编码
- [ ] 高性能客户端
- [ ] 服务注册
- [ ] 超时处理
- [ ] 支持HTTP协议
- [ ] 负载均衡
- [ ] 服务发现与注册中心

## 总结
### 1. 服务端与消息编码
主要实现服务端接收消息的基本框架，主要包括

- 读取请求 readRequest
- 处理请求 handleRequest
- 回复请求 sendResponse

读取以及回复需要编解码，框架允许一次接收多个请求，而处理请求是异步的，因此回复请求时需要加锁，因为不知道处理请求什么时候处理完，而一次只能回复一个请求

### 2. 高性能客户端
RPC 的客户端主要实现两个功能，一个是包装请求并发送出去，另一个是接收服务端的响应；除此之外，还需要实现供用户自定义的服务端连接接口，比如指定服务端 IP

- 发送请求
加发送锁，记录一下该 call 在客户端缓存中，格式为 map[uint64]*Call，key 为 seq

如果发生错误，调用 call.done，移出缓存中的 call；未发生错误时就编码发送

- 接收响应
for 循环一直接收响应，直到有错误产生，客户端起一个协程即可；

循环内部，解码 header，如果有错误就处理错误；无错时解码 body 得到 reply
